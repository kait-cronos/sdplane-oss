log file /var/log/sdplane.log
log stdout

debug sdplane fdb-change
debug sdplane rib

set device 02:00.0 driver unbound
set device 02:00.0 driver vfio-pci driver_override
set device 02:00.0 driver vfio-pci bind

set device 03:00.0 driver unbound
set device 03:00.0 driver vfio-pci driver_override
set device 03:00.0 driver vfio-pci bind

set rte_eal argv -c 0x7
rte_eal_init

set worker lthread stat-collector
set worker lthread rib-manager

stop port all
set l3fwd l3fwd_enabled_port_mask 0x3
set l3fwd l3fwd_mapping_port_queue_lcore (0,0,1),(1,0,1)
set l3fwd l3fwd_lookup_mode lpm
set l3fwd l3fwd_eth_dest 0,48:4d:7e:ec:8a:b2
set l3fwd l3fwd_eth_dest 1,48:4d:7e:ec:8a:c6
set l3fwd l3fwd_rule_ipv4 /etc/sdplane/lpmV4.cfg
set l3fwd l3fwd_rule_ipv6 /etc/sdplane/lpmV6.cfg
set worker lcore 1 l3fwd-lpm
l3fwd init

set mempool

# queue config should be after rib-manager.
set thread 1 port 0 queue 0
set thread 1 port 1 queue 0

# need to stop port before changing ports.
stop port all
set port all dev-configure 1 4
set port all nrxdesc 1024
set port all ntxdesc 1024
set port all promiscuous enable

set worker lcore 2 tap-handler
start port all

# waiting for the port to come up.
sleep 5
start worker lcore all
update port status
